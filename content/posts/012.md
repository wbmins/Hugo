---
title: "Github Actions VS Travis"
date: 2019-03-15
draft: false
tags: ["Hugo","Travis","Github Actions"] #标签
categories: ["生命不息 折腾不止", "折腾博客的那点事","自动部署"] #分类
featured_image: #顶部图片
description:  #描述
---
## 正文

- [GitHub Actions](https://github.com/features/actions) 是 GitHub 的[持续集成服务](http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html),于2018年10月推出

- [Travis CI](https://travis-ci.org/)是在线托管的CI服务,用Travis来进行持续集成,不需要自己搭服务器,傻瓜式操作,用起来更方便.最重要的是,它对开源项目是免费的

### **Travis配置**

- 使用Github账户登录[Travis](https://travis-ci.org/)

- Github的setting -> Developer setting -> Personal access tokens 创建一个token, Select scopes选项记得选中所有

- 然后**一定要复制token值,他只会出现一次**

- 在Travis的setting页面找到自己要自动部署的仓库(存放hugo源码的仓库)

- 点setting 在Environment Variables添加NAME: GITHUB_TOKEN,VALUE:你刚刚复制token的值

### **Travis部署**

- 在你的hugo源码项目根目录添加.travis.yml文件

```txt
language: go
go:
- "1.8"  # 指定Golang 1.8
env:
global:
- GH_REF: github.com/wbmins/wbmins.github.io # Github Pages
before_install:
- sudo apt-get install libstdc++6 # 安装依赖
- wget -q -O hugo.deb https://github.com/gohugoio/hugo/releases/download/v0.55.6/hugo_extended_0.55.6_Linux-64bit.deb # 安装 hugo （version: v0.54.0）
- sudo dpkg -i hugo.deb
install: # 运行hugo命令
- hugo
script:
- cd ./public
- git init
- git config user.name "wbmins"
- git config user.email "wbminions@gmail.com"
- git add .
- git commit -m "Update Blog By TravisCI With Build $TRAVIS_BUILD_NUMBER"
- git push --force --quiet "https://$GITHUB_TOKEN@${GH_REF}" master:master  # Github Pages
```

### **Github Actions配置**

- 通过git配置的邮箱生成提交代码用的ssh key

```txt
ssh-keygen -t rsa -b 4096 -C "$(git config user.email)" -f gh-pages -N ""
# You will get 2 files:
#   gh-pages.pub (public key)
#   gh-pages     (private key)
```
- 进**存放hugo源码的仓库**的settings,再点击Secrets,然后添加咱们刚刚生成的私钥，name为ACTIONS_DEPLOY_KEY

- 进**gitname.github.io**的仓库,点击Deploy keys,添加公钥,Allow write access一定要勾上,否则会无法提交

### **Github Actions脚本**

- 在hugo源码仓库**根目录**下面新建.github/workflows/main.yml

```txt
name: CI #自动化的名称
on:
push: # push的时候触发
    branches: # 那些分支需要触发
    - master
jobs:
build:
    runs-on: ubuntu-latest # 镜像市场
    steps:
    - name: checkout # 步骤的名称
        uses: actions/checkout@master #软件市场的名称
        with: # 参数
        submodules: true
    - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2.2.2
        with:
        hugo-version: '0.59.1'
        extended: true
    - name: Build
        run: hugo --minify
    - name: Deploy
        uses: peaceiris/actions-gh-pages@v2.5.1
        env:
        ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        EXTERNAL_REPOSITORY: gitname/gitname.github.io #gitname替换成github用户名
        PUBLISH_BRANCH: master
        PUBLISH_DIR: ./public
```
# 参考链接

- [HUGO通过GITHUB ACTION部署到GITHUB PAGES](https://tianhui.xin/blog/2019/11/17/hugousegithubactionstopages/)

- [使用 Travis CI 自动部署 Hugo 博客](https://mogeko.me/2018/028/)